# Contribution Guide

Hey there! I'm really excited that you are interested in contributing. Before submitting your contribution, please make sure to take a moment and read through the following guide.

## 👨🏻‍💻 Repository Setup

I recommend you install [`ni`](https://github.com/antfu/ni) so you don't need to worry about the package manager when switching across different projects.

To set the repository up:

| Step | Command
| - | - 
| 1. Install [`Node.js`](https://nodejs.org/en/about/releases/), using the [latest LTS](https://nodejs.org/en/about/releases/) | -
| 2. [Enable Corepack](#Corepack) | `corepack enable`
| Install [@antfu/ni](https://github.com/antfu/ni) | `npm i -g @antfu/ni`
| 4. Install dependencies under the project root | `ni`

## 💡 Commands

`nr dev`

Start the development environment

`nr play`

If it's a Node.js package, it starts a dev server for the playground. The code is usually under `playground/`.

`nr build`

Build the project for production. The result is usually under `dist/`.

`nr lint`

Run the tests. The repository using [Vitest](https://vitest.dev/).

`nr docs`

If the project contains documentation, you can run `nr docs` to start the documentation dev server. Use `nr docs:build` to build the docs for production.

`nr`

For more, you can run base `nr`, which will prompt a list of all available scrips.

## 🙌 Sending Pull Request

### Discuss First

Before you start to work on a feature pull request, it's always better to open a feature request issue first to discuss with the maintainers whether the feature is desired and design of those features. This would help save time for both the maintainers and the contributors and help features to be shipped faster.

For typo fixes,, it is recommended to batch multiple typo fixes into one pull request to maintain a cleaner commit history.

### Commit Convention

The repository use [Conventional Commits](https://www.conventionalcommits.org/) for commit messages, which allows the changelog to be auto-generated based on the commits. Please read the guide through if you aren't familiar with it already.

Only `fix:` and `feat:` will be presented in the changelog.

Note that `fix:` and `feat:` are for actual code changes (that might affect logic). For typo or document changes, use `docs:` or `chore:` instead:

> ~~fix: typo~~ -> docs: fix typo

### Pull Request

If you don't know how to send a Pull Request, you can reading the [guide](https://docs.github.com/en/pull-requests/collaborating-with-pull-requests/proposing-changes-to-your-work-with-pull-requests/creating-a-pull-request).

When sending a pull request, make sure your PR's title also follows the [Commit Convention](#Commit-Convention).

If your PR fixes or resolves an existing issue, please add the following line in your PR description (replace `123` with a real issue number)

> fix [#123]()

This will let Github know the issues are linked, and automatically close them once the PR gets merged. Learn more at the [guide](https://docs.github.com/en/issues/tracking-your-work-with-issues/linking-a-pull-request-to-an-issue#linking-a-pull-request-to-an-issue-using-a-keyword).

### Releasing

Before you do, make sure you have lastest git commit from upstream and all CI passes.

For most of the time, run `nr release`. It will prompts a list for the target version you want to release. After select, it will bump your package.json and commit the changes with git tag, powered by [bumpp](https://github.com/antfu/bumpp).

There are two kinds of publishing setup, either of them are done by `nr release` already.

1. **Build Locally**

Make sure you have your local [`npm` logged in](http://npm.github.io/installation-setup-docs/installing/logging-in-and-out.html) before doing that.

In `package.json`

```json
{
  "scripts": {
    "prepublishOnly": "nr build"
  }
}
```

So whenever you run `npm publish`, it will make sure you have the latest change in the distribution.

2. **Build on CI**

For complex projects that take long time to build, we might move the building and publishing process to CI. So it doesn't block your local workflow.

They will be triggered by the `v` prefixed git tag added by `bumpp`. The action is usually defined under `.github/workflows/release.yml`

> When maintaining your own fork, you might need to see GITHUB_TOKEN secret to your repository for it to publish the packages.

> Changelogs are always generated by Github Actions.

## 📗 References

### Corepack

To enable it run

```sh
corepack enable
```

#### What's Corepack

[`Corepack`](https://nodejs.org/api/corepack.html) makes sure you are using the correct version for package manager when you run corresponding commands. Projects might have `packageManager` field in their `package.json`.

under projects with configuration as shown on the right, corepack will install v7.1.5 of pnpm (if you don't have it already) and use it to run your commands. This makes sure everyone working on this project have the same behavior for the dependencies and the lockfile.

`package.json`

```json
{
  "packageManager": "pnpm@8.6.10"
}
```

### ESlint

This repository use [ESlint](https://eslint.org/) for both linting and formatting with [@antfu/eslint-config](https://github.com/antfu/eslint-config)

## 📝 Additional Info

- CLI Tools:

[ni](https://github.com/antfu/ni) - package manager alias

[esno](https://github.com/antfu/esno) - TypeScript runner

[bumpp](https://github.com/antfu/bumpp) - version bumpper


- `ni`

In addition of `ni`, here is a few shell aliases to be even lazier:

```sh
alias d="nr dev"
alias b="nr build"
alias t="nr test"
alias tu="nr test -u"
alias p="nr play"
alias c="nr typecheck"
alias lint="nr lint"
alias lintf="nr lint --fix"
alias release="nr release"
```
